<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rumofuture.nemo.repository.mapper.BookMapper">

    <resultMap id="bookMap" type="com.rumofuture.nemo.model.domain.Book">
        <id column="id" property="id"/>
        <result column="object_id" property="objectId"/>
        <result column="status" property="status"/>
        <result column="create_at" property="createAt"/>
        <result column="update_at" property="updateAt"/>
        <result column="name" property="name"/>
        <result column="style" property="style"/>
        <result column="introduction" property="introduction"/>
        <result column="source_url" property="sourceUrl"/>
        <result column="cover_url" property="coverUrl"/>
        <result column="page_total" property="pageTotal"/>
        <result column="favor_total" property="favorTotal"/>
        <result column="type" property="type"/>
        <result column="open" property="open"/>
        <result column="copyright" property="copyright"/>
    </resultMap>

    <!--保存-->
    <insert id="insert" parameterType="book" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO book(
            object_id, status, create_at, update_at, author_id, name, style, introduction,
            source_url, cover_url, page_total, favor_total, type, open, copyright
        )
        VALUES(
            #{objectId}, #{status}, #{createAt}, #{updateAt}, #{author.id}, #{name}, #{style},
            #{introduction}, #{sourceUrl}, #{coverUrl}, #{pageTotal}, #{favorTotal},
            #{type}, #{open}, #{copyright}
        )
    </insert>

    <!--更新-->
    <update id="update" parameterType="book">
        UPDATE book
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="password != null">password = #{password},</if>
            <if test="orgId != null">org_id = #{orgId},</if>
            <if test="orgCode != null">org_code = #{orgCode},</if>
            <if test="orgName != null">org_name = #{orgName},</if>
            <if test="updateTime != null">update_at = #{updateAt}</if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 删除 -->
    <update id="delete" parameterType="int">
        UPDATE book SET status = 0 WHERE id = #{id}
    </update>

    <!--查找-->
    <select id="selectOne" parameterType="int" resultMap="bookMap">
        SELECT * FROM book WHERE id = #{id}
    </select>

    <select id="selectListByAuthor" resultMap="bookMap">
        SELECT * FROM book WHERE author_id = #{authorId} AND status > 0 ORDER BY id
    </select>
</mapper>